{% extends "chargen/index.html" %}

{% block tracker %}
<p>You are currently inputting ability scores.</p>
{% endblock %}

{% block abilityscores %}
<form method="POST">{% csrf_token %}
    <table>
        <tr>
            <td>
                <table class="ability_score_table">
                {{ ab_score_form.as_table }}
                </table>
            </td>
            <td>
                <div>
                    <p class="total_ability_score_title"> 
                        <span id="total_ability_score_box"></span> points spent
                    </p>
                </div>
            </td>
        </tr>
    </table>
<input id="submitbutton" name="ability_scores_submit_button" type="submit" value="Next step" />
</form>

<script type="text/javascript">
    function updateAbilityScores() {
        var strength_box = document.getElementById("id_strength");
        var dexterity_box = document.getElementById("id_dexterity");
        var constitution_box = document.getElementById("id_constitution");
        var intelligence_box = document.getElementById("id_intelligence");
        var wisdom_box = document.getElementById("id_wisdom");
        var charisma_box = document.getElementById("id_charisma");

        strength = strength_box.options[strength_box.selectedIndex].value;
        dexterity = dexterity_box.options[dexterity_box.selectedIndex].value;
        constitution = constitution_box.options[constitution_box.selectedIndex].value;
        intelligence = intelligence_box.options[intelligence_box.selectedIndex].value;
        wisdom = wisdom_box.options[wisdom_box.selectedIndex].value;
        charisma = charisma_box.options[charisma_box.selectedIndex].value;

        document.getElementById("total_ability_score_box").innerHTML = 
            getCost(strength) + getCost(dexterity) + getCost(constitution) + getCost(intelligence) + getCost(wisdom) + getCost(charisma)
    }

    function getCost(ability) {
        //returns the point-buy cost for an ability
        var cost_table = new Array();
        cost_table [8] = 0;
        cost_table [9] = 1;
        cost_table [10] = 2;
        cost_table [11] = 3;
        cost_table [12] = 4;
        cost_table [13] = 5;
        cost_table [14] = 7;
        cost_table [15] = 9;
        cost_table [16] = 12;
        cost_table [17] = 15;
        cost_table [18] = 19;

        return cost_table[ability]        
    }

    $('#submitbutton').submit(function(){ //listen for submit event
        $.each(params, function(i,param){
            $('<input />').attr('type', 'hidden')
                .attr('name', param.name)
                .attr('value', param.value)
                .appendTo('#submitbutton');
        });

    return true;
});
</script>

<script type="text/javascript">updateAbilityScores();</script>
{% endblock abilityscores %}
